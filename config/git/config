# vim:ft=gitconfig

[core]
	pager = delta-wrapper

[init]
	# Newspeak is double-plus ungood
	defaultBranch = master

# That's me!
[user]
	name = Magnus Bergmark
	email = me@mange.dev
	signingkey = 2EA6F4AA110A1BF2227519A90443C69F6F022CDE

[github]
	user = Mange

[interactive]
	diffFilter = delta --color-only

# Custom colors, pagers, etc.
[color "branch"]
	remote = blue
	current = bold green
	local = green

[color "diff-highlight"]
	oldNormal = red bold
	oldHighlight = red bold 52
	newNormal = green bold
	newHighlight = green bold 22

# Sign commits
[commit]
	gpgsign = true

[log]
	showSignature = false
	date = format:%Y-%m-%d %H:%M

# Merge/difftool settings and style
[merge]
	conflictstyle = diff3
	tool = vimdiff

[diff]
	tool = vimdiff
	compactionHeuristic = true
	colorMoved = default

[mergetool]
	prompt = true
	keepBackup = false

[mergetool "vimdiff"]
	cmd = nvim -d "$LOCAL" "$BASE" "$REMOTE" "$MERGED" -c '$wincmd w' -c 'wincmd J' -c 'windo set wrap'

# Magic rebases
[rebase]
	autosquash = true
	stat = true

# Aliases
[alias]
	new = !sh -c 'git log $1@{1}..$1@{0} \"$@\"'
	prune = !git remote | xargs -n 1 git remote prune
	find-merge = "!sh -c 'commit=$0 && branch=${1:-HEAD} && (git rev-list $commit..$branch --ancestry-path | cat -n; git rev-list $commit..$branch --first-parent | cat -n) | sort -k2 -s | uniq -f1 -d | sort -n | tail -1 | cut -f2'"
	show-merge = "!sh -c 'merge=$(git find-merge $0 $1) && [ -n \"$merge\" ] && git show $merge'"
