# i3 config file (v4)
# vim:foldmethod=marker:
#
# Please see http://i3wm.org/docs/userguide.html for a complete reference!

# {{{ Basic settings
# Mod4 is Super (Win key)
set $mod Mod4

font pango:Fira Sans Regular 8

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

focus_follows_mouse no

hide_edge_borders both
smart_borders no_gaps
gaps inner 10
gaps outer 0

new_window pixel 2
new_float pixel 2
# }}}

# {{{ Colors
# Based on Gruvbox; raw colors below:
set $dark0_hard "#1d2021"
set $dark0 "#282828"
set $dark0_soft "#32302f"
set $dark1 "#3c3836"
set $dark2 "#504945"
set $dark3 "#665c54"
set $dark4 "#7c6f64"
set $dark4_256 "#7c6f64"

set $gray_245 "#928374"
set $gray_244 "#928374"

set $light0_hard "#f9f5d7"
set $light0 "#fbf1c7"
set $light0_soft "#f2e5bc"
set $light1 "#ebdbb2"
set $light2 "#d5c4a1"
set $light3 "#bdae93"
set $light4 "#a89984"
set $light4_256 "#a89984"

set $bright_red "#fb4934"
set $bright_green "#b8bb26"
set $bright_yellow "#fabd2f"
set $bright_blue "#83a598"
set $bright_purple "#d3869b"
set $bright_aqua "#8ec07c"
set $bright_orange "#fe8019"

set $neutral_red "#cc241d"
set $neutral_green "#98971a"
set $neutral_yellow "#d79921"
set $neutral_blue "#458588"
set $neutral_purple "#b16286"
set $neutral_aqua "#689d6a"
set $neutral_orange "#d65d0e"

set $faded_red "#9d0006"
set $faded_green "#79740e"
set $faded_yellow "#b57614"
set $faded_blue "#076678"
set $faded_purple "#8f3f71"
set $faded_aqua "#427b58"
set $faded_orange "#af3a03"

# setting                outline         bg              text    indicator     child_border
client.focused           $neutral_purple $neutral_purple $light0 $neutral_blue $bright_purple
client.focused_inactive  $faded_purple   $faded_purple   $light0 $neutral_blue $faded_purple
client.unfocused         $dark3          $dark3          $light1 $faded_blue   $dark3
client.urgent            $bright_red     $bright_red     $light1 $bright_red   $bright_red
# }}}

# {{{ Early startup applications

# Lock screen on suspend, after screensaver, etc.
exec --no-startup-id xset s 660 # lock after 11 minutes
exec --no-startup-id xss-lock --transfer-sleep-lock -- lock-screen

# To deal with apps requesting privilege elevation
exec --no-startup-id /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

# Compositor
exec --no-startup-id compton --config ~/.config/compton/compton.conf
exec --no-startup-id flashfocus
exec --no-startup-id systemctl --user start redshift

# Keyboard, screens, host-specific, etc.
exec --no-startup-id ~/.local/bin/dynamic-startup

# Wallpaper, bars, etc.
exec_always --no-startup-id ~/.local/bin/set-wallpaper
exec_always --no-startup-id ~/.config/polybar/start.sh

# Daemons
exec --no-startup-id parcellite --no-icon # Clipboard manager
exec --no-startup-id syncthing-gtk --minimized
exec --no-startup-id dunst # Notification server
exec --no-startup-id udiskie --no-automount --smart-tray # Device mounter
exec --no-startup-id unclutter # Hide mouse cursor when not in use
# }}}

# {{{ Shortcuts

set $terminal kitty
set $browser firefox-developer-edition
set $browserclass firefoxdeveloperedition
set $browsername Firefox Developer Edition

# number row

# Escape and grave share physical button. I sometimes have Fn pressed and
# sometimes now; I don't care. Either should do the same.
# Label: Last Workspace
bindsym $mod+grave        workspace back_and_forth
bindsym $mod+Escape       workspace back_and_forth
# Label: Lock screen
bindsym $mod+shift+Escape exec lock-screen

# Label: System workspace
bindsym $mod+1        workspace $workspace1
# Label: Move to System workspace
bindsym $mod+shift+1  move container to workspace $workspace1

# Label: Code workspace
bindsym $mod+2        workspace $workspace2
# Label: Move to Code workspace
bindsym $mod+shift+2  move container to workspace $workspace2

# Label: Browse workspace
bindsym $mod+3        workspace $workspace3
# Label: Move to Browse workspace
bindsym $mod+shift+3  move container to workspace $workspace3

# Label: Workspace 4
bindsym $mod+4        workspace $workspace4
# Label: Move to workspace 4
bindsym $mod+shift+4  move container to workspace $workspace4

# Label: Workspace 5
bindsym $mod+5        workspace $workspace5
# Label: Move to workspace 5
bindsym $mod+shift+5  move container to workspace $workspace5

# Label: Workspace 6
bindsym $mod+6        workspace $workspace6
# Label: Move to workspace 6
bindsym $mod+shift+6  move container to workspace $workspace6

# Label: Workspace 7
bindsym $mod+7        workspace $workspace7
# Label: Move to workspace 7
bindsym $mod+shift+7  move container to workspace $workspace7

# Label: Workspace 8
bindsym $mod+8        workspace $workspace8
# Label: Move to workspace 8
bindsym $mod+shift+8  move container to workspace $workspace8

# Label: Media workspace
bindsym $mod+9        workspace $workspace9
# Label: Move to Media workspace
bindsym $mod+shift+9  move container to workspace $workspace9

# Label: Chat workspace
bindsym $mod+0        workspace $workspace10
# Label: Move to Chat workspace
bindsym $mod+shift+0  move container to workspace $workspace10

# Label: Screenshot (fullscreen)
bindsym --release $mod+minus exec screenshot full
# Label: Screenshot (area)
bindsym --release $mod+shift+minus exec screenshot area
# Label: Show window classes
bindsym --release $mod+ctrl+minus exec headless-window-classes

# 1st row

# Label: Toggle layouts
bindsym $mod+q        layout toggle all
# Label: Kill window
bindsym $mod+shift+q  kill

# Label: Focus browser
bindsym $mod+w        exec run-or-raise 'class = "$browserclass"' $browser
## Label: Run cmd
# bindsym $mod+shift+w  cmd

# Label: Focus editor
bindsym $mod+e        exec focus-editor
## Label: Run cmd
# bindsym $mod+shift+e  cmd

# Label: Resize mode
bindsym $mod+r        mode "resize"
## Label: Run cmd
# bindsym $mod+shift+r  cmd

# Label: Dropdown tasks
bindsym $mod+t        exec toggle-dropdown dropdown_vit $terminal --class dropdown_vit vit
# Label: Show Toggl
bindsym $mod+shift+t  exec toggle-dropdown "Toggl Desktop" toggldesktop

## Label: Run cmd
# bindsym $mod+y        cmd
## Label: Run cmd
# bindsym $mod+shift+y  cmd

# Label: Focus offhand
bindsym $mod+u        [con_mark="offhand"] focus
# Label: Mark offhand
bindsym $mod+shift+u  unmark offhand; mark offhand

# Bindings taken by dunst
# Label: Notification close
# USED: $mod+i
# Label: Notification context menu
# USED: $mod+shift+i
# Label: Notification history
# USED: $mod+ctrl+i

## Label: Run cmd
# bindsym $mod+o        cmd
## Label: Run cmd
# bindsym $mod+shift+o  cmd

# Label: Passwords rofi
bindsym $mod+p exec --no-startup-id "bwmenu --clear 20"
## Label: Run cmd
# bindsym $mod+shift+p  cmd

# 2nd row

## Label: Run cmd
# bindsym $mod+a        cmd
## Label: Run cmd
# bindsym $mod+shift+a  cmd

# Label: Split
bindsym $mod+s        split toggle
# Label: Toggle sticky
bindsym $mod+shift+s  sticky toggle

## Label: Run cmd
# bindsym $mod+d        cmd
## Label: Run cmd
# bindsym $mod+shift+d  cmd

# Label: Fullscreen toggle
bindsym $mod+f        fullscreen toggle
# Label: Floating toggle
bindsym $mod+shift+f  floating toggle

# Label: Dropdown terminal
bindsym $mod+g        exec toggle-dropdown dropdown_kitty $terminal --class dropdown_kitty
# Label: Dropdown calculator
bindsym $mod+shift+g  exec toggle-dropdown dropdown_calc $terminal --class dropdown_calc qalc

# Label: Focus ←
bindsym $mod+h        focus left
# Label: Move ←
bindsym $mod+shift+h  move left
# Label: Monitor ←
bindsym $mod+ctrl+h   focus output left
bindsym $mod+shift+ctrl+h move workspace to output left, focus

# Label: Focus ↓
bindsym $mod+j        focus down
# Label: Move ↓
bindsym $mod+shift+j  move down
# Label: Monitor ↓
bindsym $mod+ctrl+j   focus output down
bindsym $mod+shift+ctrl+j move workspace to output down, focus

# Label: Focus ↑
bindsym $mod+k        focus up
# Label: Move ↑
bindsym $mod+shift+k  move up
# Label: Monitor ↑
bindsym $mod+ctrl+k   focus output up
bindsym $mod+shift+ctrl+k move workspace to output up, focus

# Label: Focus →
bindsym $mod+l        focus right
# Label: Move →
bindsym $mod+shift+l  move right
# Label: Monitor →
bindsym $mod+ctrl+l   focus output right
bindsym $mod+shift+ctrl+l move workspace to output right, focus

# Label: Terminal in same dir
bindsym $mod+Return        exec samedir $terminal
# Label: Terminal
bindsym $mod+shift+Return  exec $terminal

# 3rd row

# Label: Quit
bindsym $mod+z        exec i3quit
# Label: i3 reload
bindsym $mod+shift+z  reload
# Label: Restart i3
bindsym $mod+ctrl+z   restart

# Label: Reflow screens
bindsym $mod+x        exec --no-startup-id autorandr --change --default horizontal
## Label: Run cmd
# bindsym $mod+shift+x  cmd

## Label: Run cmd
# bindsym $mod+c        cmd
## Label: Run cmd
# bindsym $mod+shift+c  cmd

## Label: Run cmd
# bindsym $mod+v        cmd
# Bound by parcellite
# Label: Clipboard manager
# USED: $mod+shift+v

# Label: Goto
bindsym $mod+b        exec i3-input -F '[con_mark="%s"] focus' -P "Go to:"
# Label: Mark
bindsym $mod+shift+b  exec i3-input -F 'mark "%s"' -P "Mark:"
# Label: Remove mark
bindsym $mod+ctrl+b   exec i3-input -F 'unmark "%s"' -P "Unmark:"

# Label: Focus floating/tiling
bindsym $mod+n        focus mode_toggle
# Label: Focus parent
bindsym $mod+shift+n  focus parent
# Label: Focus child
bindsym $mod+ctrl+n   focus child

# Label: Media mode
bindsym $mod+m        mode "media"
## Label: Run cmd
# bindsym $mod+shift+m  cmd

## Label: Run cmd
# bindsym $mod+comma        cmd
## Label: Run cmd
# bindsym $mod+shift+comma  cmd

## Label: Run cmd
# bindsym $mod+period        cmd
## Label: Run cmd
# bindsym $mod+shift+period  cmd

# Label: Vifm
bindsym $mod+slash        exec samedir $terminal vifm
# Label: Toggle cheatsheet
bindsym $mod+shift+slash  exec i3cheatsheet

# Label: Rofi
bindsym $mod+space exec --no-startup-id "rofi -show combi -modi combi,run,window,emoji -combi-modi drun,window,emoji"
# Label: Tydra
bindsym $mod+shift+space exec $terminal --class dropdown_tydra zsh -ic "tydra ~/.config/tydra/main.yml"

# Media keys and other misc

bindsym XF86MonBrightnessUp exec brightnessctl set +10%
bindsym XF86MonBrightnessDown exec brightnessctl set 10%-
bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +5%
bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -5%
bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle
bindsym XF86AudioPlay  exec --no-startup-id playerctl play-pause
bindsym XF86AudioPause exec --no-startup-id playerctl play-pause
bindsym XF86AudioNext  exec --no-startup-id playerctl next
bindsym XF86AudioPrev  exec --no-startup-id playerctl previous

# In case of emergency
bindsym ctrl+shift+Escape exec --no-startup-id ~/.local/bin/fix-keyboard

# Modes
mode "media" {
  # Media player controls (se also "
  bindsym j  exec --no-startup-id playerctl play-pause
  bindsym k exec --no-startup-id playerctl play-pause
  bindsym l  exec --no-startup-id playerctl next
  bindsym h  exec --no-startup-id playerctl previous

  # Pulse Audio controls
  bindsym plus exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +5%
  bindsym minus exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -5%
  bindsym 0 exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle

  # back to normal: Enter / Escape / Space
  bindsym Return mode "default"
  bindsym Escape mode "default"
  bindsym Space mode "default"
}

mode "resize" {
  # These bindings trigger as soon as you enter the resize mode

  bindsym h exec --no-startup-id i3resize left
  bindsym j exec --no-startup-id i3resize down
  bindsym k exec --no-startup-id i3resize up
  bindsym l exec --no-startup-id i3resize right

  # back to normal: Enter or Escape
  bindsym Return mode "default"
  bindsym Escape mode "default"
  bindsym $mod+r mode "default"
}

# }}}

# {{{ Workspaces

set $workspace1   "1:System"
set $workspace2   "2:Code"
set $workspace3   "3:Browse"
set $workspace4   "4"
set $workspace5   "5"
set $workspace6   "6"
set $workspace7   "7"
set $workspace8   "8:Game"
set $workspace9   "9:Media"
set $workspace10 "10:Chat"

# Switching to active workspace does nothing
workspace_auto_back_and_forth no

# }}}

# {{{ Assignments

for_window [workspace=$workspace10] layout stacked

# Toggle floating as soon as dropdown windows are created to avoid flickering.
for_window [class="dropdown_*"] floating enable
for_window [class="dropdown_kitty"] border pixel 5

for_window [class="dropdown_tydra"] \
    border pixel 5, \
    resize set 60 ppt 50 ppt, \
    move position center

assign [class="spotify-tui"] $workspace9
# Spotify does not set class before displaying window, so force window movement
# always instead.
# https://github.com/i3/i3/issues/2060
for_window [class="Spotify"] move to workspace $workspace9

for_window [window_role="GtkFileChooserDialog"] \
  resize set 800 600, \
  move position center

assign [class="Firefox"] $workspace3
assign [class="Slack"] $workspace10
assign [class="TelegramDesktop"] $workspace10
assign [class="discord"] $workspace10

# Steam
assign [class="Steam"] $workspace8 # Main Steam window
assign [title="^Steam$"] $workspace8 # "Installing updates"
for_window [class="^Steam$" title="^Friends$"] floating enable
for_window [class="^Steam$" title="Steam - News"] floating enable
for_window [class="^Steam$" title=".* - Chat"] floating enable
for_window [class="^Steam$" title="^Settings$"] floating enable
for_window [class="^Steam$" title=".* - event started"] floating enable
for_window [class="^Steam$" title=".* CD key"] floating enable
for_window [class="^Steam$" title="^Steam - Self Updater$"] floating enable
for_window [class="^Steam$" title="^Screenshot Uploader$"] floating enable
for_window [class="^Steam$" title="^Steam Guard - Computer Authorization Required$"] floating enable
for_window [title="^Steam Keyboard$"] floating enable

# Floating terminal windows.
for_window [class="kitty" window_role="floating"] \
    floating enable, \
    resize set 60 ppt 50 ppt, \
    move position center

for_window [class="(?i)floating"] \
    floating enable, \
    resize set 60 ppt 50 ppt, \
    move position center

# Youtube PiP / ytpip
for_window [title="(?i)youtube pip"] floating enable, sticky enable

# Cheatsheet images
for_window [title="i3 cheatsheet"] \
  floating enable, \
  move position center

# }}}

# {{{ Late startup programs

exec workrave
exec startup-reminder
exec telegram-desktop
exec $browser
exec spotify
exec keybase-gui

# }}}
