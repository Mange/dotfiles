# vim: ft=sh
# Shell function in order to be able to affect outside environment variables.

function theme() {
  local usage="
theme <light|dark|reload>

Toggle between light and dark theme in most apps, or reload colors in current
terminal."
  local new_style
  local should_reload

  case "$1" in
    dark)
      new_style=dark
      should_reload=1
      ;;
    light)
      new_style=light
      should_reload=1
      ;;
    reload)
      should_reload=1
      ;;
    --help)
      echo "$usage"
      return 0
      ;;
    *)
      echo "$usage" >&2
      return 1
  esac

  if [[ -n $new_style ]]; then
    ~/.local/bin/_theme_set "$new_style"
    ~/.local/bin/set-wallpaper
    pgrep -u "$USER" polybar >/dev/null && polybar-msg cmd restart 2>/dev/null
  fi

  if [[ -n $should_reload ]]; then
    ~/.local/bin/_theme_reload_window

    # Load the current style from disk
    if [[ -z $new_style ]]; then
      new_style="$(cat "${XDG_RUNTIME_DIR}/current_theme")"
    fi

    # Set the shell variable so other programs can pick it up
    if [[ -n $new_style ]]; then
      export KITTY_THEME="$new_style"
    fi
  fi
}
