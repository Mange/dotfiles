# yaml-language-server: $schema=https://raw.githubusercontent.com/ansible-community/schemas/main/f/ansible-tasks.json
- block:
    - name: Configure pacman
      become: true
      lineinfile:
        path: /etc/pacman.conf
        line: "{{ item.line }}"
        regexp: "{{ item.regexp }}"
        backrefs: "{{ item.backrefs }}"
      loop:
        - { line: "Color", regexp: "#Color", backrefs: false }
        - { line: "CheckSpace", regexp: "#CheckSpace", backrefs: false }
        - {
            line: "IgnorePkg = kglobalaccel",
            regexp: "IgnorePkg",
            backrefs: false,
          }

    - name: Enable Multilib
      become: true
      ini_file:
        path: /etc/pacman.conf
        section: "{{ item.section }}"
        option: "{{ item.option }}"
        value: "{{ item.value | default(omit) }}"
      loop:
        - {
            section: "multilib",
            option: "Include",
            value: "/etc/pacman.d/mirrorlist",
          }

    - name: Update pacman
      become: true
      pacman:
        update_cache: true
        upgrade: false

    - name: Install base-devel
      become: true
      pacman:
        name: base-devel
        state: present

    - name: Upgrade pacman
      become: true
      pacman:
        update_cache: false
        upgrade: true

    - include_role:
        name: paru
