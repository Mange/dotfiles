#!/usr/bin/env bash

set -e
wikipath=~/Documents/Wiki/

selected_filename=$(
  find "$wikipath" -not -path '*/.stversions/*' -and -name '*.md' -printf '%C@ %P\n' |
    finder --numeric-reversed
)

path="${wikipath}${selected_filename}"

if [[ -f "$path" ]]; then
  if [[ -t 1 ]]; then
    exec nvim "$path"
  else
    kitty nvim "$path"
  fi
else
  smart-notification \
    --urgency=critical \
    --icon=error \
    --app-name \
    "open-wiki" \
    "Could not open" "Could not find ${path}"
fi
