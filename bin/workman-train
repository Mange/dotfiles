#!/bin/sh

ensure_installed() {
  hash "$1" >/dev/null 2>/dev/null || (
    echo "Could not find $1" >&2
    exit 1
  )
}

ensure_installed gkbd-keyboard-display

restore() {
  echo "Restoring…"

  setxkbmap us
  fix-keyboard

  killall --quiet --user "$USER" -- gkbd-keyboard-display
}

train() {
  echo "Starting…"

  setxkbmap workman
  xset r rate 300 40

  # Show keyboard reference on screen
  gkbd-keyboard-display -l workman
}

trap 'restore' 'INT'
train
restore
