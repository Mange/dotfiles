#!/bin/bash

dry_run=0

while [[ $# -gt 0 ]]; do
  case "$1" in
    --help)
      echo "Usage: aur gc [--dry-run]"
      exit 0
      ;;
    --dry-run)
      shift
      dry_run=1
      ;;
    *)
      echo "Unknown option: $1" >&2
      exit 1
  esac
done

if [[ $dry_run == 1 ]]; then
  options="-xn"
else
  options="-xf"
fi

for dir in "${XDG_CACHE_HOME:-$HOME/.cache}"/aurutils/sync/*; do
  if [[ -d "$dir" && -e "${dir}/PKGBUILD" ]]; then
    (cd "$dir" && git clean "$options")
  fi
done
